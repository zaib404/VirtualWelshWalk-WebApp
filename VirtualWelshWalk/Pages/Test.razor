@page "/Test"

@using EmailService;
@attribute [AllowAnonymous]

@inject EmailTemplate.Services.IRazorViewToStringRenderer _razorViewToStringRenderer
@inject EmailService.IEmailSender _emailSender


<div class="container p-5">
    <button class="btn btn-primary" style="width:100%;" @onclick="@SendEmail">Confirm Email</button>
</div>

<div class="container p-5">
    <button class="btn btn-primary" style="width:100%;" @onclick="@SendEmail2">Reset Password</button>
</div>

<div class="container p-5">
    <button class="btn btn-primary" style="width:100%;" @onclick="@SendEmail3">Milestone</button>
</div>

<div class="container p-5">
    <button class="btn btn-primary" style="width:100%;" @onclick="@SendEmail4">Not Async Milestone</button>
</div>

@code {

    async Task SendEmail()
    {
        var confirmAccountModel = new EmailTemplate.Views.Emails.ConfirmAccount.ConfirmAccountEmailViewModel(
            "https://localhost:44350/Identity/Account/ConfirmEmail?userId=e800d8be-51eb-4a8d-a98c-b31cff6563c5&code=Q2ZESjhBVURsVUs1ZTkxRGlFSkU0OG5YNGNkcVp4M2VscFFRRW4wVkdOWjdFQ3JRQW9rVkFEa0MrQ0tVRWY0OGQ3VzRZVVZJOGNEcUVmT0hBS056RklBTDRHNzQvQTVVTTJ1VGFSTlNRaTJiaElKU25MTGJYcHNSU3BBVUhrQml5azRzdjJWTlVmbldHdFZTSTluRzJxVU5udUNqNGdmZ2NJOVhmVWJrVVJvMDRPRGZMb3BDNG80VHltOHl3Zm1EWG5tTElDRG5RVk4zL0pwWnovRTZwM1pXS3RuNC9WZUdZa25Gclh1OGxMSHpjSEJXZXVka2pnbWtRVGdhUU9PTFVhaVJrdz09&returnUrl=%2F");

        string body = await _razorViewToStringRenderer.RenderViewToStringAsync(@"\Views\Emails\ConfirmAccount\ConfirmAccount.cshtml", confirmAccountModel);

        var message = new Message(new string[] { "zaib_inamdar@hotmail.com" }, "Confirm your email", body, null);

        await _emailSender.SendEmailAsync(message);
    }

    async Task SendEmail2()
    {
        var confirmAccountModel = new EmailTemplate.Views.Emails.ForgotPassword.ForgotPasswordEmailViewModel("https://localhost:44350/Identity/Account/ConfirmEmail?userId=e800d8be-51eb-4a8d-a98c-b31cff6563c5&code=Q2ZESjhBVURsVUs1ZTkxRGlFSkU0OG5YNGNkcVp4M2VscFFRRW4wVkdOWjdFQ3JRQW9rVkFEa0MrQ0tVRWY0OGQ3VzRZVVZJOGNEcUVmT0hBS056RklBTDRHNzQvQTVVTTJ1VGFSTlNRaTJiaElKU25MTGJYcHNSU3BBVUhrQml5azRzdjJWTlVmbldHdFZTSTluRzJxVU5udUNqNGdmZ2NJOVhmVWJrVVJvMDRPRGZMb3BDNG80VHltOHl3Zm1EWG5tTElDRG5RVk4zL0pwWnovRTZwM1pXS3RuNC9WZUdZa25Gclh1OGxMSHpjSEJXZXVka2pnbWtRVGdhUU9PTFVhaVJrdz09&returnUrl=%2F",
            "TEST" + " " + "Test");

        string body = await _razorViewToStringRenderer.RenderViewToStringAsync(@"\Views\Emails\ForgotPassword\ForgotPassword.cshtml", confirmAccountModel);

        var message = new Message(new string[] { "zaib_inamdar@hotmail.com" }, "Reset your password", body, null);

        await _emailSender.SendEmailAsync(message);
    }

    async Task SendEmail3()
    {
        var confirmAccountModel = new EmailTemplate.Views.Emails.Milestone.NewMilestoneModel("Tintern Abbey", "Test Test");

        string body = await _razorViewToStringRenderer.RenderViewToStringAsync(@"\Views\Emails\Milestone\NewMilestone.cshtml", confirmAccountModel);

        var message = new Message(new string[] { "zaib_inamdar@hotmail.com" }, "Postcard from Tintern Abby", body, new List<string>() { @"EmailAttachments\Welsh coastal walk .pdf" });

        await _emailSender.SendEmailAsync(message);
    }

    void SendEmail4()
    {
        var confirmAccountModel = new EmailTemplate.Views.Emails.Milestone.NewMilestoneModel("Tintern Abbey", "Test Test");

        string body = _razorViewToStringRenderer.RenderViewToStringAsync(@"\Views\Emails\Milestone\NewMilestone.cshtml", confirmAccountModel).Result;

        var message = new Message(new string[] { "zaib_inamdar@hotmail.com" }, "Postcard from Tintern Abby", body, new List<string>() { @"EmailAttachments\Welsh coastal walk .pdf" });

        _emailSender.SendEmailAsync(message);
    }

}
