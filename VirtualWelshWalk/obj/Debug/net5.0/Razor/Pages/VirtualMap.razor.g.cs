#pragma checksum "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "1a4b61f4b99e27b0e259eeec7af2e564799cf12b"
// <auto-generated/>
#pragma warning disable 1591
namespace VirtualWelshWalk.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\_Imports.razor"
using VirtualWelshWalk;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\_Imports.razor"
using VirtualWelshWalk.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
using DataAccess.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
using VirtualWelshWalk.DataAccess.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
using VirtualWelshWalk.DataAccess.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
using Microsoft.AspNetCore.Identity;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
using System.Security.Claims;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\_Imports.razor"
[Authorize]

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/Virtual Coastal Map")]
    public partial class VirtualMap : Microsoft.AspNetCore.Components.ComponentBase, IAsyncDisposable
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
            __builder.AddMarkupContent(0, "<link href=\"https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.css\" rel=\"stylesheet\">\r\n\r\n");
            __builder.AddMarkupContent(1, @"<style>
    .marker {
        background-size: cover;
        cursor: pointer;
        background-position: center;
        background-repeat: no-repeat;
        top: -30px;
    }

    #map {
        height: 500px;
        width: 100%;
    }
</style>");
#nullable restore
#line 39 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
 if (virtualWalk.Equals(null))
{

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(2, "<p>Loading...</p>");
#nullable restore
#line 42 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
}
else
{

#line default
#line hidden
#nullable disable
            __builder.OpenElement(3, "div");
            __builder.AddAttribute(4, "class", "container text-center pt-5");
            __builder.OpenElement(5, "h1");
            __builder.AddAttribute(6, "class", "heading1");
            __builder.AddContent(7, 
#nullable restore
#line 47 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                              Localizer["Next milestone"]

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(8, ":");
            __builder.CloseElement();
            __builder.AddMarkupContent(9, "\r\n        ");
            __builder.OpenElement(10, "h2");
            __builder.AddAttribute(11, "class", "heading2");
            __builder.AddAttribute(12, "id", 
#nullable restore
#line 48 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                  landID

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(13, 
#nullable restore
#line 48 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                           Localizer[landID]

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(14, "\r\n        <hr>\r\n        ");
            __builder.OpenElement(15, "h5");
            __builder.AddAttribute(16, "class", "text-center");
            __builder.OpenElement(17, "a");
            __builder.AddAttribute(18, "class", "font-weight-bold");
            __builder.AddContent(19, 
#nullable restore
#line 51 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                         milesToNextMilestone

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(20, " ");
            __builder.AddContent(21, 
#nullable restore
#line 51 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                                               Localizer["Miles"].ToString().ToLower()

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddContent(22, " ");
            __builder.AddContent(23, 
#nullable restore
#line 51 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                                                                                            Localizer["away"]

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.OpenElement(24, "div");
            __builder.AddAttribute(25, "class", "container-fluid");
            __builder.AddAttribute(26, "style", "padding: 5%; padding-bottom:3%; padding-top:3%;");
            __builder.OpenElement(27, "h5");
            __builder.AddAttribute(28, "class", "text-center");
            __builder.AddContent(29, 
#nullable restore
#line 57 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
             Localizer["Total miles"]

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(30, ": ");
            __builder.OpenElement(31, "a");
            __builder.AddAttribute(32, "class", "font-weight-bold");
            __builder.AddContent(33, 
#nullable restore
#line 57 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                                                    totalMiles

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(34, "\r\n            <br>\r\n            ");
            __builder.AddContent(35, 
#nullable restore
#line 59 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
             Localizer["Miles remaining"]

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(36, ": ");
            __builder.OpenElement(37, "a");
            __builder.AddAttribute(38, "class", "font-weight-bold");
            __builder.AddContent(39, 
#nullable restore
#line 59 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                                                        milesRemaining

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(40, "\r\n        <br>\r\n\r\n        ");
            __builder.OpenElement(41, "div");
            __builder.AddAttribute(42, "id", "map");
            __builder.AddElementReferenceCapture(43, (__value) => {
#nullable restore
#line 63 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                            mapElement = __value;

#line default
#line hidden
#nullable disable
            }
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(44, "\r\n\r\n        <br>\r\n        ");
            __builder.OpenElement(45, "h4");
            __builder.AddAttribute(46, "class", "text-center");
            __builder.AddContent(47, 
#nullable restore
#line 67 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
             Localizer["You have walked"]

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(48, ": ");
            __builder.AddContent(49, 
#nullable restore
#line 67 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                            totalMilesWalked

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(50, " ");
            __builder.AddContent(51, 
#nullable restore
#line 67 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                                              space

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(52, " ");
            __builder.AddContent(53, 
#nullable restore
#line 67 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                                                     Localizer["Miles"].ToString().ToLower()

#line default
#line hidden
#nullable disable
            );
            __builder.AddMarkupContent(54, "\r\n            <br>\r\n            ");
            __builder.AddContent(55, 
#nullable restore
#line 69 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
             Localizer["Step counter"]

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(56, ": ");
            __builder.AddContent(57, 
#nullable restore
#line 69 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                         virtualWalk.TotalSteps

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(58, "\r\n        <br>");
            __builder.CloseElement();
            __builder.OpenElement(59, "div");
            __builder.AddAttribute(60, "class", "container pb-5 text-center");
            __builder.OpenElement(61, "h1");
            __builder.AddAttribute(62, "class", "h1");
            __builder.AddContent(63, 
#nullable restore
#line 75 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                        Localizer["Did you know"]

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(64, ":");
            __builder.CloseElement();
            __builder.AddMarkupContent(65, "\r\n        <br>\r\n        ");
            __builder.OpenElement(66, "h4");
            __builder.AddContent(67, 
#nullable restore
#line 77 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
             Localizer[MilestoneInfo]

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(68, "\r\n        ");
            __builder.OpenElement(69, "img");
            __builder.AddAttribute(70, "class", "img-fluid");
            __builder.AddAttribute(71, "src", 
#nullable restore
#line 78 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                     MilestonePic

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.CloseElement();
#nullable restore
#line 80 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"

    //When the pages loads for the first time. Show this popup asking uuser if they wish to add steps

    

#line default
#line hidden
#nullable disable
#nullable restore
#line 83 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
     if (showEnterStepsModal)
    {
        // Show modal/popup of user confirming

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(72, "<div class=\"modal-backdrop fade show\"></div>");
            __builder.OpenElement(73, "div");
            __builder.AddAttribute(74, "class", "modal fade show");
            __builder.AddAttribute(75, "tabindex", "-1");
            __builder.AddAttribute(76, "role", "dialog");
            __builder.AddAttribute(77, "style", "display: block;");
            __builder.OpenElement(78, "div");
            __builder.AddAttribute(79, "class", "modal-dialog modal-dialog-centered");
            __builder.OpenElement(80, "div");
            __builder.AddAttribute(81, "class", "modal-content text-center");
            __builder.OpenElement(82, "div");
            __builder.AddAttribute(83, "class", "modal-header");
            __builder.OpenElement(84, "h2");
            __builder.AddAttribute(85, "class", "widow-orpah-me modal-title text-center");
            __builder.AddContent(86, 
#nullable restore
#line 93 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                                                            Localizer["Do you wish to add new steps?"]

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(87, "\r\n                        ");
            __builder.OpenElement(88, "button");
            __builder.AddAttribute(89, "type", "button");
            __builder.AddAttribute(90, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 94 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                                        CloseInputStepForms

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(91, "class", "close");
            __builder.AddAttribute(92, "data-dismiss", "modal");
            __builder.AddAttribute(93, "aria-label", "Close");
            __builder.AddMarkupContent(94, "<span aria-hidden=\"true\">&times;</span>");
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(95, "\r\n\r\n                    ");
            __builder.OpenElement(96, "div");
            __builder.AddAttribute(97, "class", "modal-body");
            __builder.OpenComponent<VirtualWelshWalk.Shared.InputStepsForm>(98);
            __builder.AddAttribute(99, "dbPeople", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<VirtualWelshWalk.DataAccess.Models.People>(
#nullable restore
#line 100 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                                                   people

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(100, "dbVirtualWalk", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<VirtualWelshWalk.DataAccess.Models.VirtualWalk>(
#nullable restore
#line 100 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                                                                          virtualWalk

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(101, "dbMilestone", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<VirtualWelshWalk.DataAccess.Models.VirtualMilestone>(
#nullable restore
#line 100 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                                                                                                    milestone

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(102, "OnVirtualMapSubmit", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<Microsoft.AspNetCore.Components.EventCallback>(Microsoft.AspNetCore.Components.EventCallback.Factory.Create(this, 
#nullable restore
#line 101 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                                            Update

#line default
#line hidden
#nullable disable
            )));
            __builder.AddAttribute(103, "OnVirtualMapGetInfo", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<Microsoft.AspNetCore.Components.EventCallback<System.Int32>>(Microsoft.AspNetCore.Components.EventCallback.Factory.Create<System.Int32>(this, 
#nullable restore
#line 101 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                                                                          ShowMileStoneUnlocked

#line default
#line hidden
#nullable disable
            )));
            __builder.AddComponentReferenceCapture(104, (__value) => {
#nullable restore
#line 100 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                              stepsForm = (VirtualWelshWalk.Shared.InputStepsForm)__value;

#line default
#line hidden
#nullable disable
            }
            );
            __builder.CloseComponent();
            __builder.CloseElement();
            __builder.AddMarkupContent(105, "\r\n\r\n                    ");
            __builder.OpenElement(106, "div");
            __builder.AddAttribute(107, "class", "modal-footer");
            __builder.OpenElement(108, "button");
            __builder.AddAttribute(109, "type", "button");
            __builder.AddAttribute(110, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 105 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                                        CloseInputStepForms

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(111, "class", "btn btn-secondary");
            __builder.AddAttribute(112, "data-dismiss", "modal");
            __builder.AddContent(113, 
#nullable restore
#line 105 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
                                                                                                                             Localizer["Close"]

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.CloseElement();
#nullable restore
#line 110 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
    }

#line default
#line hidden
#nullable disable
#nullable restore
#line 110 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
     
}

#line default
#line hidden
#nullable disable
        }
        #pragma warning restore 1998
#nullable restore
#line 114 "D:\Zaib\Documents\Areca Design\VirtualWelshWalk\VirtualWelshWalk\Pages\VirtualMap.razor"
 
    public People people { get; set; } = new People();
    public VirtualWalk virtualWalk { get; set; } = new VirtualWalk();
    public VirtualMilestone milestone { get; set; } = new VirtualMilestone();

    CalculatePersonsPosition calculatePerson = new CalculatePersonsPosition();

    ElementReference mapElement;
    IJSObjectReference mapModule, mapInstance;

    #region elementIds
    string landID = "landID";
    #endregion

    string WalkName = "Welsh Coastal Walk";

    double milesToNextMilestone = 0;
    double totalMilesWalked = 0;
    double milesRemaining = 0;
    double totalMiles = 476.3;

    bool showEnterStepsModal = false;

    string MilestoneInfo = "Loading...";
    string MilestonePic;
    string space = " ";

    InputStepsForm stepsForm;

    protected override async Task OnInitializedAsync()
    {
        people = await PeopleService.GetPeople();

        if (people == null)
        {
            await _signInManager.SignOutAsync();
        }
        else
        {
            virtualWalk = await WalkService.GetVirtualWalk(WalkName, people.PeopleId);

            milestone = await VirtualMilestoneService.GetVirtualMilestones(WalkName, people.PeopleId);
        }

    }

    async Task GetSession()
    {
        var count = await sessionStorage.GetItemAsync<int>("firstVisit");

        if (count == 0)
        {
            showEnterStepsModal = true;
            await sessionStorage.SetItemAsync("firstVisit", 1);
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await GetSession();

            var success = SetUpInputStepsForm();

            try
            {
                ShowMileStoneUnlocked(await stepsForm.CallVirtualMapGetInfoChanged(virtualWalk.TotalSteps));
            }
            catch (Exception e)
            {
                System.Diagnostics.Debug.WriteLine(e.Message);
                success = false;
            }

            if (success)
            {
                mapModule = await jsRunTime.InvokeAsync<IJSObjectReference>("import", "./scripts/MapBox.js");

                string json = System.IO.File.ReadAllText("./wwwroot/scripts/WalkRoute.json");
                await mapModule.InvokeVoidAsync("ParseJson", json);

                mapInstance = await mapModule.InvokeAsync<IJSObjectReference>(
                    "initialize", mapElement).AsTask();

                if (virtualWalk != null && mapModule != null)
                {
                    try
                    {
                        await UpdatePersonLocation();
                    }
                    catch (Exception e)
                    {

                    }
                }

                await jsRunTime.InvokeVoidAsync("window.onload").AsTask();
            }
            else
            {
                // Force Reload
                NavigationManager.NavigateTo("Virtual Coastal Map", true);
            }

            StateHasChanged();
        }
    }

    bool SetUpInputStepsForm()
    {
        bool rtnVal = true;

        try
        {
            stepsForm = new InputStepsForm();
            stepsForm.SetUpFromVirtualMap(VirtualMilestoneService, milestone, emailSender, _razorViewToStringRenderer, AuthenticationStateProvider);
            rtnVal = true;
        }
        catch
        {
            rtnVal = false;
        }

        return rtnVal;
    }

    async Task UpdatePersonLocation()
    {
        if (virtualWalk.TotalSteps >= 0)
        {
            var check = await mapModule.InvokeAsync<bool>("CheckIfStyleLoaded");

            while (!check)
            {
                check = await mapModule.InvokeAsync<bool>("CheckIfStyleLoaded");
            }

            if (check)
            {
                await mapModule.InvokeVoidAsync("updatePersonIcon", calculatePerson.NewPosition(virtualWalk.TotalSteps)).AsTask();
                landID = await mapModule.InvokeAsync<string>("NextLandMark", landID);
                milesToNextMilestone = Math.Round(await mapModule.InvokeAsync<double>("ApproximateMilesToNextMilestone"), 2);

                totalMilesWalked = StepsInMiles();
                milesRemaining = Math.Round(totalMiles - totalMilesWalked, 2);

                if (milesRemaining <= 0)
                {
                    milesRemaining = 0;
                }

                if (landID.ToLower() == "City Walls".ToLower())
                {
                    milesRemaining = milesToNextMilestone;
                }

                await mapModule.InvokeVoidAsync("colourPath");

            }
        }
    }

    async Task Update()
    {
        showEnterStepsModal = false;
        await UpdatePersonLocation();
        await mapModule.InvokeVoidAsync("UpdateColourPath");
    }

    async Task CloseInputStepForms()
    {
        //await stepsForm.CallVirtualMapGetInfoChanged();
        await Update();
        showEnterStepsModal = false;
    }

    protected void ShowMileStoneUnlocked(int number)
    {
        switch (number)
        {
            case 0:

                MilestoneInfo = "Tintern Abbey was founded on 9 May 1131 by Walter de Clare, Lord of Chepstow. " +
                        "It is situated adjacent to the village of Tintern in Monmouthshire, on the Welsh bank of the River Wye, " +
                        "which at this location forms the border between Monmouthshire in Wales and Gloucestershire in England.";

                MilestonePic = "/Assets/Culture/Tintern Abbey.jpg";

                break;

            case 1:

                MilestoneInfo = "The Newport Transporter Bridge is a transporter bridge that crosses the River Usk in Newport, South East Wales. " +
                        "It is one of fewer than 10 transporter bridges that remain in use worldwide; only a few dozen were ever built. " +
                        "It is one of only two operational transporter bridges in Britain, the other being the Tees Transporter Bridge.";

                MilestonePic = "/Assets/Culture/Transporter Bridge.jpg";

                break;

            case 2:

                MilestoneInfo = "Cardiff Castle is located in the Castle Quarter, in the heart of Cardiff, the capital of Wales. " +
                        "There has been a fort on the site for almost 2,000 years. " +
                        "The current building was built in the late 11th century, replacing a Roman fort.";

                MilestonePic = "/Assets/Culture/Cardiff Castle.jpg";

                break;

            case 3:

                MilestoneInfo = "Rest Bay is a golden, sandy beach on the outskirts of the town of Porthcawl, " +
                        "backed by The Royal Porthcawl Golf Club and low cliffs. The beach faces south-west, " +
                        "which means that it is not sheltered from the Atlantic winds and the waves here can be quite large, " +
                        "making it a good beach for surfing, as well as wind/kite surfing.";

                MilestonePic = "/Assets/Culture/Rest bay Beach.jpg";

                break;

            case 4:

                MilestoneInfo = "The Mumbles Pier is one of only six surviving iron piers in Wales. " +
                        "Mumbles Pier was opened to the public on the 10th May 1898. A family run business " +
                        "‘The Pier’ is one of very few privately owned Piers left in the UK. Once a station for " +
                        "the world famous Mumbles Railway, the site is steeped in a rich history and continues to be a " +
                        "seaside tourist attraction for many families across the UK.";

                MilestonePic = "/Assets/Culture/Mumbles Pier.jpg";

                break;

            case 5:

                MilestoneInfo = "Fall bay is one of the hardest to reach bays on Gower, " +
                        "however the walk is well worth it and the beach is never crowded due " +
                        "to its remoteness. There is no beach visible at high tide. The beach is " +
                        "very popular with surfers. At very low tide, it is possible to walk over " +
                        "from the beach to Mewslade Bay.";

                MilestonePic = "/Assets/Culture/Fall Bay.jpg";

                break;

            case 6:

                MilestoneInfo = "Parc y Scarlets is a rugby union stadium in Llanelli, " +
                        "Carmarthenshire, that opened in November 2008 as the new home of " +
                        "the Scarlets and Llanelli RFC. The ground replaced Stradey Park, the " +
                        "home of Llanelli's rugby teams for almost 130 years. The stadium complex " +
                        "includes facilities for matchday supporters and for non-matchday revenue generation, " +
                        "as well as a training barn and a training pitch with athletics track.";

                MilestonePic = "/Assets/Culture/Parc y Scarlets.jpg";

                break;

            case 7:

                MilestoneInfo = "Kidwelly Castle is a Norman castle overlooking the River Gwendraeth and the town of Kidwelly, Carmarthenshire, " +
                        "Wales. Origin of this surname trace back to when it was spelled Cygweli which means " + '\u0022' + "swan." + '\u0022' + "" +
                        " Later in its history, it was unsuccessfully besieged by forces of Owain Glyndŵr in 1403 with assistance from soldiers from " +
                        "France and Brittany who captured Kidwelly town. The castle was relieved by a Norman army after just three weeks.";

                MilestonePic = "/Assets/Culture/Kidwelly Castle.jpg";

                break;

            case 8:

                MilestoneInfo = "St. Catherine’s Island is a small tidal island linked to Tenby in Pembrokeshire, Wales. " +
                        "2016 The Final Problem, the third and last episode of the fourth series of the BBC TV series " +
                        "Sherlock was filmed on the island, with it standing in as a maximum security prison.  Formed from an " +
                        "outcrop of limestone, on average 25m high, the island is riddled with tidal caves.";

                MilestonePic = "/Assets/Culture/St Catherine’s Island.jpg";

                break;

            case 9:

                MilestoneInfo = "Barafundle Bay was named in Passport Magazine’s best beaches in the world. " +
                        "The remote sand patch came 17th in the top 25. Barafundle Bay is a remote, slightly curved, " +
                        "east-facing sandy beach in Pembrokeshire, Wales, near Stackpole Quay and is part of the Stackpole Estate, " +
                        "managed by The National Trust.";

                MilestonePic = "/Assets/Culture/Barafundle Bay.jpg";

                break;

            case 10:

                MilestoneInfo = "Stack Rock Fort is a fort built on a small island in the Milford Haven Waterway, " +
                        "Pembrokeshire. A 3-gun fort was built between 1850 and 1852, and then upgraded in 1859 with a new " +
                        "building that completely encased the original gun tower. The fort housed three 32-pounder guns, " +
                        "as well as a single 12-pounder for protection of the walls of the dock.";

                MilestonePic = "/Assets/Culture/Stack Rock Fort.jpg";

                break;

            case 11:

                MilestoneInfo = "St. Davids Cathedral is situated in St. Davids in the county of Pembrokeshire, on the most westerly point of Wales. " +
                        "There are at least three services said or sung per day, each week, with sung services on five out of seven days. " +
                        "The cathedral choir at St. Davids was the first cathedral choir in the United Kingdom to use girls and men as the main choir, rather than boys and men.";

                MilestonePic = "/Assets/Culture/St Davids Cathedral.jpg";

                break;

            case 12:

                MilestoneInfo = "Strumble Head Lighthouse stands imposingly on Ynysmeicl (St. Michael's Island), " +
                        "an islet to the west of Fishguard, separated from the mainland by a very narrow gap through " +
                        "which the sea boils and froths in stormy weather.";

                MilestonePic = "/Assets/Culture/Strumble Head Lighthouse.jpg";

                break;

            case 13:

                MilestoneInfo = "Cardigan Castle is a castle overlooking the River Teifi in Cardigan, " +
                        "Ceredigion, Wales. The castle dates from the late 11th-century, " +
                        "though was rebuilt in 1244. Castle Green House was built inside the castle walls in the early 1800s.";

                MilestonePic = "/Assets/Culture/Cardigan Castle.jpg";

                break;

            case 14:

                MilestoneInfo = "Plas Tan y Bwlch in Gwynedd, Wales, is the Snowdonia National Park Environmental Studies Centre, " +
                        "administered by the National Park Authority. The Centre aims to provide courses which are of interest to all " +
                        "lovers of the countryside who would like to know about this fascinating area of Wales.";

                MilestonePic = "/Assets/Culture/St Padarns Church.jpg";

                break;

            case 15:

                MilestoneInfo = "This Round House was erected in 1834. " +
                        "It was built as a lock-up where drunkards were detained until they became sober. " +
                        "It was also a place of detention pending the transfer of an accused to the nearest place where justice could be administered. " +
                        "The key was kept by the Parish Constable. The building is divided by a partition wall forming two cells of equal dimensions. " +
                        "One cell was reserved for men and the other for women.";

                MilestonePic = "/Assets/Culture/Round House.jpg";

                break;

            case 16:

                MilestoneInfo = "Harlech Castle in Harlech, Gwynedd, Wales, is a medieval fortification built onto a rocky knoll close to the Irish Sea. " +
                        "It was built by Edward I during his invasion of Wales between 1282 and 1289 at the relatively modest cost of £8,190. Over the next " +
                        "few centuries, the castle played an important part in several wars, withstanding the siege of Madog ap Llywelyn between 1294–95, " +
                        "but falling to Owain Glyndŵr in 1404. It then became Glyndŵr's residence and military headquarters for the remainder of the uprising " +
                        "until being recaptured by English forces in 1409.";

                MilestonePic = "/Assets/Culture/Harlech Castle.jpg";

                break;

            case 17:

                MilestoneInfo = "Nant Gwrtheyrn is a Welsh Language and Heritage Centre, " +
                        "located near the village of Llithfaen on the northern coast of the Llŷn Peninsula, " +
                        "Gwynedd, in northwest Wales. The Centre specialises in Welsh for Adults (as a second language) " +
                        "and offers intensive residential courses throughout the year. Visitors to the area can enjoy our " +
                        "Heritage Centre which houses displays about the Welsh language and culture, as well as the history " +
                        "of the village which includes a period house set in a Victorian quarry community and information about " +
                        "the unique wildlife which can be discovered in this remote coastal valley and beach.";

                MilestonePic = "/Assets/Culture/Nant Gwrtheyrn.jpg";

                break;

            case 18:

                MilestoneInfo = "Beddgelert is a village and community in the Snowdonia area of Gwynedd, Wales. " +
                        "It is reputed to be named after the legendary hound Gelert. " +
                        "Gelert is a legendary dog associated with the village of Beddgelert " +
                        "(whose name means " + '\u0022' + "Gelert's Grave" + '\u0022' + ") in Gwynedd, " +
                        "north-west Wales. In the legend, Llywelyn the Great returns from hunting to find his baby missing, " +
                        "the cradle overturned, and Gelert with a blood-smeared mouth. Believing the dog had savaged the child, " +
                        "Llywelyn draws his sword and kills Gelert. After the dog's dying yelp Llywelyn hears the cries of the baby, " +
                        "unharmed under the cradle, along with a dead wolf which had attacked the child and been killed by Gelert. " +
                        "Llywelyn is overcome with remorse and buries the dog with great ceremony, but can still hear its dying yelp. " +
                        "After that day Llywelyn never smiles again.";

                MilestonePic = "/Assets/Culture/Bedd Gelert.jpg";

                break;

            case 19:

                MilestoneInfo = "Caernarfon Castle is a medieval fortress in Caernarfon, Gwynedd, " +
                        "north-west Wales cared for by Cadw, the Welsh Government's historic environment service. " +
                        "It was a motte-and-bailey castle from the late 11th century until 1283 when King Edward I of England began to replace it with the current stone structure.";

                MilestonePic = "/Assets/Culture/Caernarfon Castle.jpg";

                break;

            case 20:

                MilestoneInfo = "Beaumaris on the island of Anglesey is famous as the greatest castle never built. " +
                        "It was the last of the royal strongholds created by Edward I in Wales – and perhaps his masterpiece. " +
                        "Beaumaris Castle was never fully built, but had it been completed it would probably have closely resembled Harlech Castle. " +
                        "Both castles are concentric in plan, with walls within walls, although Beaumaris is the more regular in design.";

                MilestonePic = "/Assets/Culture/Beaumaris Castle.jpg";

                break;

            case 21:

                MilestoneInfo = "Conwy Castle (Welsh: Castell Conwy) is a fortification in Conwy, " +
                        "located in North Wales. It was built by Edward I, during his conquest of Wales, " +
                        "between 1283 and 1289. The castle hugs a rocky coastal ridge of grey sandstone and limestone, " +
                        "and much of the stone from the castle is largely taken from the ridge itself, probably when the site was first cleared.";

                MilestonePic = "/Assets/Culture/Conwy Castle.jpg";

                break;

            case 22:

                MilestoneInfo = "The city walls are the oldest, longest and most complete in Britain, parts of which are almost 2000 years old. " +
                    "Chester is the only city in Britain that retains the full circuit of its ancient defensive walls. " +
                    "Walking the complete circuit gives wondrous views down into the city and gives a fantastic insight into Chester's long history.";

                MilestonePic = "/Assets/Culture/City Walls.jpg";

                break;

            default:

                MilestoneInfo = "Tintern Abbey was founded on 9 May 1131 by Walter de Clare, " +
                "Lord of Chepstow. It is situated adjacent to the village of Tintern in " +
                "Monmouthshire, on the Welsh bank of the River Wye, which at this location " +
                "forms the border between Monmouthshire in Wales and Gloucestershire in England.";

                MilestonePic = "/Assets/Culture/Tintern Abbey.jpg";

                break;
        }
    }

    async ValueTask IAsyncDisposable.DisposeAsync()
    {
        if (mapInstance != null)
        {
            await mapInstance.DisposeAsync();
        }

        if (mapModule != null)
        {
            await mapModule.DisposeAsync();
        }
    }

    double StepsInMiles()
    {
        // Convert to kilometers
        double km = Math.Round(virtualWalk.TotalSteps / 1312.33595801, 2);


        // Convert to miles
        return Math.Round(km * 0.62137, 1);
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private EmailTemplate.Services.IRazorViewToStringRenderer _razorViewToStringRenderer { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private SignInManager<User> _signInManager { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager NavigationManager { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private AuthenticationStateProvider AuthenticationStateProvider { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private EmailService.IEmailSender emailSender { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private Blazored.SessionStorage.ISessionStorageService sessionStorage { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IVirtualMilestonesService VirtualMilestoneService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IPeopleService PeopleService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IVirtualWalkService WalkService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime jsRunTime { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private Microsoft.Extensions.Localization.IStringLocalizer<App> Localizer { get; set; }
    }
}
#pragma warning restore 1591
